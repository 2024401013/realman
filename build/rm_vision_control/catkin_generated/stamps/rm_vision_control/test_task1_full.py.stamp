#!/usr/bin/env python
# test_task1_full.py - 完整测试裂缝检测任务
import rospy
import time
from std_msgs.msg import Int32, Float32
from task_crack_detection import CrackDetectionTask

class Task1FullTest:
    def __init__(self):
        rospy.init_node('task1_full_test')
        
        # 发布测试命令
        self.cmd_pub = rospy.Publisher('/car/is_arrive', Int32, queue_size=10)
        self.speed_pub = rospy.Publisher('/car/speed', Float32, queue_size=10)
        
        rospy.loginfo("Task 1 Full Test initialized")
    
    def run_full_test(self):
        """运行完整测试"""
        rospy.loginfo("=== TASK 1 FULL TEST ===")
        
        # 1. 启动裂缝检测任务
        rospy.loginfo("\n1. Starting crack detection task...")
        self.cmd_pub.publish(Int32(1))
        rospy.sleep(5.0)  # 等待任务启动
        
        # 2. 检查是否在往返运动
        rospy.loginfo("\n2. Testing reciprocating motion...")
        rospy.sleep(10.0)  # 观察10秒
        
        # 3. 模拟检测到裂缝
        rospy.loginfo("\n3. Simulating crack detection...")
        # 这里可以添加模拟检测的逻辑
        rospy.sleep(4.0)  # 等待超过4秒间隔
        
        # 4. 停止任务
        rospy.loginfo("\n4. Stopping task...")
        self.cmd_pub.publish(Int32(2))
        rospy.sleep(3.0)
        
        # 5. 检查是否回到初始位置
        rospy.loginfo("\n5. Checking return to home...")
        rospy.sleep(2.0)
        
        rospy.loginfo("\n✓ Task 1 full test completed")
        return True

if __name__ == '__main__':
    try:
        tester = Task1FullTest()
        success = tester.run_full_test()
        exit(0 if success else 1)
    except rospy.ROSInterruptException:
        pass